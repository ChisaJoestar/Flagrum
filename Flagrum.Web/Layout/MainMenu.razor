@using System.Diagnostics
@inject IWpfService WpfService

<CascadingValue Value="this">
    <div class="h-full bg-dark flex-shrink-0 flex flex-col border-dark-550 border-r">
        <MenuItem Icon="apps" Text="Mod Library" DefaultActive="true" Uri="/"/>
        <MenuItem Icon="menu_book" Text="Tutorials" Uri="/tutorials"/>
        <MenuItem Icon="map" Text="Roadmap" Uri="/roadmap"/>
        @* <MenuItem Icon="videogame_asset" Text="Asset Explorer" Uri="/assets"/> *@
        @* <MenuItem Icon="search" Text="File Inspector" Uri="/inspector"/> *@
        @* <MenuItem Icon="share" Text="Sequence Editor" Uri="/sequenceeditor"></MenuItem> *@
        <div class="flex-grow"></div>
        <MenuItem Icon="info_outline" Text="About" Uri="/about"/>
        <MenuItem Icon="settings" Text="Settings" Uri="/settings"/>
        <img @onclick="OpenDiscordLink" src="discord-button.png" class="p-2 rounded-md bg-grey-800 shadow-md mt-4 mx-4 cursor-pointer" style="max-width: 150px"/>
        <div class="p-4">
            <small class="text-grey-500">Flagrum v@(Version)</small>
        </div>
    </div>
</CascadingValue>

@code
{
    private List<MenuItem> Items { get; set; } = new();
    private string Version { get; set; }

    protected override void OnInitialized()
    {
        var v = WpfService.GetVersion();
        Version = $"{v.Major}.{v.Minor}.{v.Build}";
    }

    public void AddItem(MenuItem item)
    {
        Items.Add(item);
    }

    public void SetActiveItem(MenuItem item)
    {
        foreach (var i in Items)
        {
            if (i == item)
            {
                i.Activate();
            }
            else
            {
                i.Deactivate();
            }
        }

        StateHasChanged();
    }

    private void OpenDiscordLink()
    {
        const string url = "https://discord.gg/7cNNwwJKsJ";
        Process.Start(new ProcessStartInfo(url)
        {
            UseShellExecute = true
        });
    }
}